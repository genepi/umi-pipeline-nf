nextflow_process {

    name "Test Process CLUSTER"
    script "lib/processes/cluster.nf"
    process "CLUSTER"

    test("Should run without failures") {

        when {
            process {
                """
                input[0] = Channel.of(
                    ["barcode02", "raw", "$baseDir/tests/input/cluster/barcode02/detected_umis.fastq"],
                    ["barcode03", "raw", "$baseDir/tests/input/cluster/barcode03/detected_umis.fastq"],
                    ["barcode04", "raw", "$baseDir/tests/input/cluster/barcode04/detected_umis.fastq"],
                    ["barcode05", "raw", "$baseDir/tests/input/cluster/barcode05/detected_umis.fastq"],
                    ["barcode06", "raw", "$baseDir/tests/input/cluster/barcode06/detected_umis.fastq"],
                    ["barcode07", "raw", "$baseDir/tests/input/cluster/barcode07/detected_umis.fastq"]
                )
                input[1] = Channel.of("raw", "raw", "raw", "raw", "raw", "raw")
                """
            }
        }

        then {
            assert process.success
            assert snapshot(process.out).match()
        }

    }

}
